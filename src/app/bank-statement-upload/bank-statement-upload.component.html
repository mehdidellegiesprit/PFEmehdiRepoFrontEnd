<p>bank-statement-upload works!</p>
<input type="file" (change)="onFileInputChange($event)" />

<form
  #releveBancaireForm="ngForm"
  (ngSubmit)="onConfirmAll(releveBancaireForm.value)"
>
  <div *ngIf="releveBancaire">
    <p>
      nomBank:
      <input type="text" name="nomBank" [(ngModel)]="releveBancaire.nomBank" />
    </p>
    <p>
      IBAN:
      <input type="text" name="iban" [(ngModel)]="releveBancaire.iban" />
    </p>
    <p>
      Nom societe:
      <input
        type="text"
        name="nom_societe"
        [(ngModel)]="releveBancaire.nom_societe"
      />
    </p>

    <div *ngFor="let extrait of releveBancaire.extraits; let i = index">
      <h3>Extrait {{ i + 1 }}</h3>
      <!-- a tester -->
      <p>
        Date d'extrait:
        <input
          type="date"
          name="dateExtrait{{ i }}"
          [(ngModel)]="extrait.dateExtrait"
        />
      </p>
      <p>
        Total mouvements débit:
        <input
          type="text"
          name="totalMouvementsDebit{{ i }}"
          [(ngModel)]="extrait.totalMouvementsDebit"
        />
      </p>
      <p>
        Total mouvements crédit:
        <input
          type="text"
          name="totalMouvementsCredit{{ i }}"
          [(ngModel)]="extrait.totalMouvementsCredit"
        />
      </p>
      <p>
        Date du solde créditeur début mois:
        <input
          type="date"
          name="dateDuSoldeCrediteurDebutMois{{ i }}"
          [(ngModel)]="extrait.dateDuSoldeCrediteurDebutMois"
        />
      </p>
      <p>
        Crédit du solde créditeur début mois:
        <input
          type="text"
          name="creditDuSoldeCrediteurDebutMois{{ i }}"
          [(ngModel)]="extrait.creditDuSoldeCrediteurDebutMois"
        />
      </p>
      <p>
        Date du solde créditeur fin mois:
        <input
          type="date"
          name="dateDuSoldeCrediteurFinMois{{ i }}"
          [(ngModel)]="extrait.dateDuSoldeCrediteurFinMois"
        />
      </p>
      <p>
        Crédit du solde créditeur fin mois:
        <input
          type="text"
          name="creditDuSoldeCrediteurFinMois{{ i }}"
          [(ngModel)]="extrait.creditDuSoldeCrediteurFinMois"
        />
      </p>

      <!-- a tester -->
      <h4>Données</h4>
      <table>
        <tr>
          <th>Date donnée extrait</th>
          <th>Date valeur donnée extrait</th>
          <th>Opérations</th>
          <th>Débit</th>
          <th>Crédit</th>
        </tr>
        <tr *ngFor="let donnee of extrait.donneeExtraits; let j = index">
          <td>
            <input
              *ngIf="donnee.editing"
              type="date"
              name="dateDonneeExtrait{{ i }}{{ j }}"
              [(ngModel)]="donnee.dateDonneeExtrait"
            />
            <span *ngIf="!donnee.editing">{{ donnee.dateDonneeExtrait }}</span>
          </td>
          <td>
            <input
              *ngIf="donnee.editing"
              type="date"
              name="dateValeurDonneeExtrait{{ i }}{{ j }}"
              [(ngModel)]="donnee.dateValeurDonneeExtrait"
            />
            <span *ngIf="!donnee.editing">{{
              donnee.dateValeurDonneeExtrait
            }}</span>
          </td>
          <td style="width: auto">
            <textarea
              *ngIf="donnee.editing"
              name="operations{{ i }}{{ j }}"
              [value]="donnee.operations | replace : '***' : '\n'"
              (input)="handleInputChange($event, i, j)"
              style="white-space: pre-wrap"
              rows="4"
              cols="32"
            ></textarea>
            <ng-container *ngIf="!donnee.editing">
              <span
                *ngIf="!donnee.voirPlus"
                [innerHTML]="(donnee.operations | split : '***' : 0) || ''"
              ></span>
              <span
                *ngIf="donnee.voirPlus"
                [innerHTML]="donnee.operations | replace : '***' : '<br/>'"
              ></span>
              <a
                href="#"
                (click)="
                  donnee.voirPlus = !donnee.voirPlus; $event.preventDefault()
                "
                style="color: blue; text-decoration: underline; cursor: pointer"
              >
                {{ donnee.voirPlus ? "Voir moins" : "Voir plus" }}
              </a>
            </ng-container>
          </td>

          <td>
            <input
              *ngIf="donnee.editing"
              type="text"
              name="debit{{ i }}{{ j }}"
              [(ngModel)]="donnee.debit"
            />
            <span *ngIf="!donnee.editing">{{ donnee.debit }}</span>
          </td>
          <td>
            <input
              *ngIf="donnee.editing"
              type="text"
              name="credit{{ i }}{{ j }}"
              [(ngModel)]="donnee.credit"
            />
            <span *ngIf="!donnee.editing">{{ donnee.credit }}</span>
          </td>
          <td>
            <button *ngIf="!donnee.editing" (click)="editRow(i, j)">
              Editer
            </button>
            <button *ngIf="donnee.editing" (click)="saveRow(i, j)">
              Sauvegarder
            </button>
          </td>
        </tr>
      </table>
    </div>
    <button type="submit">Confirmer</button>
  </div>
</form>
