<p>bank-statement-upload works!</p>
<input type="file" (change)="onFileInputChange($event)" />

<form
  #releveBancaireForm="ngForm"
  (ngSubmit)="onConfirmAll(releveBancaireForm.value)"
>
  <div *ngIf="releveBancaire">
    <div class="form-group row">
      <label for="nomBank" class="col-sm-2 col-form-label">nomBank:</label>
      <div class="col-sm-10">
        <input
          class="form-control"
          type="text"
          id="nomBank"
          name="nomBank"
          [(ngModel)]="releveBancaire.nomBank"
        />
      </div>
    </div>
    <div class="form-group row">
      <label for="iban" class="col-sm-2 col-form-label">IBAN:</label>
      <div class="col-sm-10">
        <input
          class="form-control"
          type="text"
          id="iban"
          name="iban"
          [(ngModel)]="releveBancaire.iban"
        />
      </div>
    </div>
    <div class="form-group row">
      <label for="nom_societe" class="col-sm-2 col-form-label"
        >Nom societe:</label
      >
      <div class="col-sm-10">
        <input
          class="form-control"
          type="text"
          id="nom_societe"
          name="nom_societe"
          [(ngModel)]="releveBancaire.nom_societe"
        />
      </div>
    </div>

    <div *ngFor="let extrait of releveBancaire.extraits; let i = index">
      <h3 style="text-align: center">
        Extrait du {{ extrait.dateExtrait | date : "dd/MM/yyyy" }}
      </h3>

      <div class="form-group row">
        <label for="dateExtrait{{ i }}" class="col-sm-2 col-form-label"
          >Date d'extrait:</label
        >
        <div class="col-sm-10">
          <input
            class="form-control"
            type="date"
            id="dateExtrait{{ i }}"
            name="dateExtrait{{ i }}"
            [(ngModel)]="extrait.dateExtrait"
          />
        </div>
      </div>
      <div class="form-group row">
        <label for="totalMouvementsDebit{{ i }}" class="col-sm-2 col-form-label"
          >Total mouvements débit:</label
        >
        <div class="col-sm-10">
          <input
            class="form-control"
            type="text"
            name="totalMouvementsDebit{{ i }}"
            [(ngModel)]="extrait.totalMouvementsDebit"
          />
        </div>
      </div>

      <div class="form-group row">
        <label
          for="totalMouvementsCredit{{ i }}"
          class="col-sm-2 col-form-label"
          >Total mouvements crédit:</label
        >
        <div class="col-sm-10">
          <input
            class="form-control"
            type="text"
            name="totalMouvementsCredit{{ i }}"
            [(ngModel)]="extrait.totalMouvementsCredit"
          />
        </div>
      </div>
      <div class="form-group row">
        <label
          for="dateDuSoldeCrediteurDebutMois{{ i }}"
          class="col-sm-2 col-form-label"
          >Date du solde créditeur début mois:</label
        >
        <div class="col-sm-10">
          <input
            class="form-control"
            type="date"
            name="dateDuSoldeCrediteurDebutMois{{ i }}"
            [(ngModel)]="extrait.dateDuSoldeCrediteurDebutMois"
          />
        </div>
      </div>

      <div class="form-group row">
        <label
          for="creditDuSoldeCrediteurDebutMois{{ i }}"
          class="col-sm-2 col-form-label"
          >Crédit du solde créditeur début mois:</label
        >
        <div class="col-sm-10">
          <input
            class="form-control"
            type="text"
            name="creditDuSoldeCrediteurDebutMois{{ i }}"
            [(ngModel)]="extrait.creditDuSoldeCrediteurDebutMois"
          />
        </div>
      </div>

      <div class="form-group row">
        <label
          for="dateDuSoldeCrediteurFinMois{{ i }}"
          class="col-sm-2 col-form-label"
          >Date du solde créditeur fin mois:</label
        >
        <div class="col-sm-10">
          <input
            class="form-control"
            type="date"
            name="dateDuSoldeCrediteurFinMois{{ i }}"
            [(ngModel)]="extrait.dateDuSoldeCrediteurFinMois"
          />
        </div>
      </div>

      <div class="form-group row">
        <label
          for="creditDuSoldeCrediteurFinMois{{ i }}"
          class="col-sm-2 col-form-label"
          >Crédit du solde créditeur fin mois:</label
        >
        <div class="col-sm-10">
          <input
            class="form-control"
            type="text"
            name="creditDuSoldeCrediteurFinMois{{ i }}"
            [(ngModel)]="extrait.creditDuSoldeCrediteurFinMois"
          />
        </div>
      </div>

      <h4>Données</h4>
      <table class="table table-striped">
        <tr>
          <th>Date donnée extrait</th>
          <th>Date valeur donnée extrait</th>
          <th>Opérations</th>
          <th>Débit</th>
          <th>Crédit</th>
        </tr>
        <tr *ngFor="let donnee of extrait.donneeExtraits; let j = index">
          <td>
            <input
              *ngIf="donnee.editing"
              type="date"
              name="dateDonneeExtrait{{ i }}{{ j }}"
              [(ngModel)]="donnee.dateDonneeExtrait"
            />
            <span *ngIf="!donnee.editing">{{ donnee.dateDonneeExtrait }}</span>
          </td>
          <td>
            <input
              *ngIf="donnee.editing"
              type="date"
              name="dateValeurDonneeExtrait{{ i }}{{ j }}"
              [(ngModel)]="donnee.dateValeurDonneeExtrait"
            />
            <span *ngIf="!donnee.editing">{{
              donnee.dateValeurDonneeExtrait
            }}</span>
          </td>
          <td style="width: auto">
            <textarea
              *ngIf="donnee.editing"
              name="operations{{ i }}{{ j }}"
              [value]="donnee.operations | replace : '***' : '\n'"
              (input)="handleInputChange($event, i, j)"
              style="white-space: pre-wrap"
              rows="4"
              cols="32"
            ></textarea>
            <ng-container *ngIf="!donnee.editing">
              <span
                *ngIf="!donnee.voirPlus"
                [innerHTML]="(donnee.operations | split : '***' : 0) || ''"
              ></span>
              <span
                *ngIf="donnee.voirPlus"
                [innerHTML]="donnee.operations | replace : '***' : '<br/>'"
              ></span>
              <a
                href="#"
                (click)="
                  donnee.voirPlus = !donnee.voirPlus; $event.preventDefault()
                "
                style="color: blue; text-decoration: underline; cursor: pointer"
              >
                {{ donnee.voirPlus ? "Voir moins" : "Voir plus" }}
              </a>
            </ng-container>
          </td>

          <td>
            <input
              *ngIf="donnee.editing"
              type="text"
              name="debit{{ i }}{{ j }}"
              [(ngModel)]="donnee.debit"
            />
            <span *ngIf="!donnee.editing">{{ donnee.debit }}</span>
          </td>
          <td>
            <input
              *ngIf="donnee.editing"
              type="text"
              name="credit{{ i }}{{ j }}"
              [(ngModel)]="donnee.credit"
            />
            <span *ngIf="!donnee.editing">{{ donnee.credit }}</span>
          </td>
          <td>
            <button *ngIf="!donnee.editing" (click)="editRow(i, j)">
              Editer
            </button>
            <button *ngIf="donnee.editing" (click)="saveRow(i, j)">
              Sauvegarder
            </button>
          </td>
        </tr>
      </table>
    </div>
    <button type="submit" class="btn btn-primary">Confirmer</button>
  </div>
</form>
